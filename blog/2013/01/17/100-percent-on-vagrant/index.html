<!doctype html><html xmlns=http://www.w3.org/1999/xhtml><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>100% on Vagrant | fabiorehm.com</title><meta property="og:title" content="100% on Vagrant - fabiorehm.com"><meta property="og:description" content="Some tips on getting the most out of Vagrant"><meta property="og:url" content="https://fabiorehm.com/blog/2013/01/17/100-percent-on-vagrant/"><meta property="og:site_name" content="fabiorehm.com"><meta property="og:type" content="article"><meta property="og:image" content="https://www.gravatar.com/avatar/2b78c6da27ec7e1419eebc8b683c25a3?s=256"><meta property="article:section" content="Blog"><meta property="article:tag" content="vagrant"><meta property="article:tag" content="vagrant-notify"><meta property="article:tag" content="rails"><meta property="article:tag" content="ruby"><meta property="article:tag" content="tmux"><meta property="article:tag" content="virtualization"><meta property="article:published_time" content="2013-01-17T00:00:00Z"><meta property="article:modified_time" content="2013-01-17T00:00:00Z"><meta name=twitter:card content="summary"><meta name=twitter:site content="@fgrehm"><meta name=twitter:creator content="@fgrehm"><link href=https://fabiorehm.com/index.xml rel=alternate type=application/rss+xml title=fabiorehm.com><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://fabiorehm.com/css/site.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://fabiorehm.com/blog/2013/01/17/100-percent-on-vagrant/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://fabiorehm.com/><h1 id=nav-heading class="title is-4">fabiorehm.com</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=email href=mailto:site@fabiorehm.com target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></i></span></a><a class=level-item aria-label=github href=https://github.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=twitter href=https://twitter.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="subtitle is-6" href=/tags/vagrant/>#vagrant</a>
| <a class="subtitle is-6" href=/tags/vagrant-notify/>#vagrant-notify</a>
| <a class="subtitle is-6" href=/tags/rails/>#rails</a>
| <a class="subtitle is-6" href=/tags/ruby/>#ruby</a>
| <a class="subtitle is-6" href=/tags/tmux/>#tmux</a>
| <a class="subtitle is-6" href=/tags/virtualization/>#virtualization</a></div><h2 class="subtitle is-6">January 17, 2013</h2><h1 class=title>100% on Vagrant</h1><div class=content><p>Last year I heard a lot about <a href=http://www.vagrantup.com/>Vagrant</a> and even
though I had the chance to play with it, performance was always an issue
that prevented me from doing 100% of my development work from a VM. By december, when
my laptop started acting weird (and eventually died) I decided that my next
computer would have as much cores and RAM that I could afford. I looked at a few
different options and ended up getting a Dell Inspiron 15R SE with a Core I7 that
has 4 cores and 8 threads and 8 Gb RAM. Combined with some Vagrant / VirtualBox tweaks,
I&rsquo;m now able to use Vagrant for pretty much <strong>all</strong> of my &ldquo;real&rdquo; (paid)
development work.</p><p>If you are thinking about doing the same or are curious about how I am doing it,
here&rsquo;s a list of some useful tips that might help you out as well. If you are
new to Vagrant, check out <a href=http://docs.vagrantup.com/v1/docs/getting-started/index.html>the getting started guide</a>
and <a href=http://nefariousdesigns.co.uk/vagrant-virtualised-dev-environments.html>this overview about it</a>.</p><h2 id=enable-nfs>Enable NFS
<a href=#enable-nfs><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>If you ever tried to run the specs for a reasonable sized Rails app from a Vagrant
box without enabling <a href=http://docs.vagrantup.com/v1/docs/nfs.html>NFS Shared folders</a>,
you probably noticed that it takes ages to run compared to your physical machine.
If you&rsquo;ve never heard of this feature, check out the link and pay attention to the
<a href=http://docs.vagrantup.com/v1/docs/nfs.html#performance_benchmarks>benchmarks</a>.</p><p>In my experience, even though I configured my VirtualBox machine <a href=https://github.com/fgrehm/rails-template/blob/master/templates/Vagrantfile#L25-L30>to use 3 cores
and 2 Gb of RAM</a>
the specs <strong>AND</strong> the app were performing really bad. It took me a while to figure
out that at least part of the issue was this as my specs went from around 2:20 minutes down
to 1:40 minute after the initial NFS warn up just by enabling this.</p><p>So try your best to use NFS Shared Folders on your projects, it will have a
<strong>HUGE</strong> impact on your productivity. If you have trouble setting it up, shoot me an
email or post a question to the <a href="https://groups.google.com/group/vagrant-up?pli=1">Vagrant mailing list</a>.</p><p>If you are an Ubuntu user like me, there is an issue that prevents it to work properly.
I don&rsquo;t remember exactly the error I had but my projects were stored under my <code>/home</code>
folder that was encrypted (I think I might have checked a box while installing the OS).
My workaround was to move all my code from <code>/home/fabio/projects</code> to <code>/home/projects</code>
but the path you use probably doesn&rsquo;t matter, as long as it is not an encrypted folder.</p><h2 id=custom-base-boxes>Custom base boxes
<a href=#custom-base-boxes><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>Rebuilding a box setting up all dependencies all the time is a PITA.</p><p>Be nice to other people on the team and make a base box with everything
set up available somewhere. Put it on your <a href=https://www.dropbox.com/help/16/en>public Dropbox folder</a> and set it as the base box on
the project&rsquo;s <code>Vagrantfile</code>.</p><p>I&rsquo;ve <a href=https://github.com/fgrehm/rails-base-box>created one</a> that I&rsquo;m using
for my Rails projects. Just by importing that base box, you&rsquo;ll get:</p><ul><li>PostgreSQL 9.1</li><li>memcached</li><li>Redis</li><li>rbenv</li><li>Ruby 1.9.3-p327 with <a href=https://gist.github.com/1688857>falcon&rsquo;s patch</a> and
some other some <a href=https://github.com/fgrehm/rails-base-box/blob/master/site.pp#L46-L48>tunings</a></li><li>NodeJS (for the asset pipeline)</li><li>PhantomJS for using <a href=https://github.com/jonleighton/poltergeist>poltergeist</a> and
<a href=https://github.com/netzpirat/guard-jasmine>guard-jasmine</a></li><li>Commonly used packages (like curl, imagemagick and git)</li></ul><p>Because it has all that set up, my <code>Vagrantfile</code> ends up being a dead simple <a href=https://github.com/fgrehm/rails-template/blob/master/templates/Vagrantfile#L37-L44>inline
bash script</a>
that creates the databases if they don&rsquo;t exist yet and I don&rsquo;t need to keep Puppet
related files under source control.</p><h2 id=shared-vagrant-box>Shared Vagrant box
<a href=#shared-vagrant-box><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>Sometimes you just want to hack on a gem, on an old app or want to try out a new language
/ framework without messing up your computer installing a lot of packages and dependencies.</p><p>In that case you don&rsquo;t need a specific <code>Vagrantfile</code> for them. You can just place one
under your <code>/home</code> folder or the root folder of all your projects and run the machine
from any project subfolder you are. Vagrant will look it up for you whenever you run
<code>vagrant up</code> or <code>vagrant ssh</code>.</p><h2 id=vagrant-notifyhttpsgithubcomfgrehmvagrant-notify><a href=https://github.com/fgrehm/vagrant-notify>vagrant-notify</a>
<a href=#vagrant-notifyhttpsgithubcomfgrehmvagrant-notify><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>If you want to use something like <a href=https://github.com/guard/guard>guard</a> or have some
other script that uses <a href=http://manpages.ubuntu.com/manpages/gutsy/man1/notify-send.1.html><code>notify-send</code></a>
that you want to run from the VM, you can make use this gem. It is not
<a href=https://github.com/fgrehm/vagrant-notify/issues>100% done</a> but it does suit
my current needs and might suit yours as well.</p><p>With the gem, whenever a Vagrant box is provisioned, the guest <code>notify-send</code> executable
will get replaced with a <a href=https://github.com/fgrehm/vagrant-notify/blob/master/files/notify-send.erb>ruby script</a>
that connects to a <a href=https://github.com/fgrehm/vagrant-notify/blob/master/lib/vagrant-notify/server.rb>TCP server</a>
running on the host machine that runs the command.</p><h2 id=drawbacks>Drawbacks
<a href=#drawbacks><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>Nothing is perfect right? There are some drawbacks of using a virtual machine
wheter you are using Vagrant or not:</p><ul><li>Your laptop battery won&rsquo;t last that much, so keep that in mind before hacking some
code on a plane.</li><li>A lot of vagrant machines means a lot of disk space will get eaten by the machines.
In average, each of my boxes is getting 2.3 Gb of my HD.</li><li>If you edit project files from your host machine using your favorite IDE,
chances are that a process on the guest machine <a href=https://github.com/mitchellh/vagrant/issues/707>won&rsquo;t get notified that a file</a> was changed. I&rsquo;m thinking about
a workaround for that and already have something on my mind. I&rsquo;ll release it as
a gem as soon as I have a chance.</li></ul><p>Apart from the file change propagation there&rsquo;s nothing much that we can do. I&rsquo;m
already <a href=https://github.com/fgrehm/rails-base-box/blob/master/purge.sh>freeing up the base box disk space</a>
when packaging my base boxes and as far as I know, at least here in Brazil there
is no such thing as an airplane with power outlets ;-)</p><div class=related></div></div></div></section><section class=section><div class=container><aside><div id=disqus_thread></div></aside><div id=show_comments><a id=load_comments class="button is-link">Load comments</a></div><script type=text/javascript>var disqus_shortname="fgrehm",hash;function disqus(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}hash=window.location.hash.substr(1),hash.length>8&&hash.substring(0,8)==="comment-"?(disqus(),document.getElementById("show_comments").style.display="none"):document.getElementById("load_comments").onclick=function(){disqus(),document.getElementById("show_comments").style.display="none"}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/fgrehm>Fabio Rehm</a> 2013-2022</p><p>Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/ribice/kiss>Kiss</a>.</p></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z78MGSF72P"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z78MGSF72P",{anonymize_ip:!1})}</script></body></html>