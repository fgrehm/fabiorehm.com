<!doctype html><html xmlns=http://www.w3.org/1999/xhtml><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Improving vagrant-lxc boxes | fabiorehm.com</title><meta property="og:title" content="Improving vagrant-lxc boxes - fabiorehm.com"><meta property="og:description" content="Updates about V3 vagrant-lxc base boxes"><meta property="og:url" content="https://fabiorehm.com/blog/2013/06/10/improving-vagrant-lxc-boxes/"><meta property="og:site_name" content="fabiorehm.com"><meta property="og:type" content="article"><meta property="og:image" content="https://www.gravatar.com/avatar/2b78c6da27ec7e1419eebc8b683c25a3?s=256"><meta property="article:section" content="Blog"><meta property="article:tag" content="vagrant"><meta property="article:tag" content="vagrant-lxc"><meta property="article:tag" content="lxc"><meta property="article:tag" content="linux containers"><meta property="article:published_time" content="2013-06-10T00:00:00Z"><meta property="article:modified_time" content="2013-06-10T00:00:00Z"><meta name=twitter:card content="summary"><meta name=twitter:site content="@fgrehm"><meta name=twitter:creator content="@fgrehm"><link href=https://fabiorehm.com/index.xml rel=alternate type=application/rss+xml title=fabiorehm.com><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://fabiorehm.com/css/site.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://fabiorehm.com/blog/2013/06/10/improving-vagrant-lxc-boxes/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://fabiorehm.com/><h1 id=nav-heading class="title is-4">fabiorehm.com</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=email href=mailto:site@fabiorehm.com target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></i></span></a><a class=level-item aria-label=github href=https://github.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=twitter href=https://twitter.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="subtitle is-6" href=/tags/vagrant/>#vagrant</a>
| <a class="subtitle is-6" href=/tags/vagrant-lxc/>#vagrant-lxc</a>
| <a class="subtitle is-6" href=/tags/lxc/>#lxc</a>
| <a class="subtitle is-6" href=/tags/linux-containers/>#linux containers</a></div><h2 class="subtitle is-6">June 10, 2013</h2><h1 class=title>Improving vagrant-lxc boxes</h1><div class=content><p>So I&rsquo;ve played with <a href=http://www.docker.io/>Docker</a> once again and have been
looking around its codebase to find out how things work over there. Even though
I&rsquo;ve never wrote a single line of <a href=http://golang.org/>Go</a>, it gave me some
interesting insights about LXC itself and about packing up containers which
influenced heavily the &ldquo;<a href=https://github.com/fgrehm/vagrant-lxc/issues/89>next generation</a>&rdquo;
vagrant-lxc base boxes and the upcoming work I have in mind for the provider.</p><p>Starting with V3 boxes, vagrant-lxc will introduce a better approach for
building base boxes and will also simplify the process of &ldquo;promoting&rdquo; existing
containers to base vagrant boxes. While it won&rsquo;t introduce breaking changes,
V3 boxes should be pushing more work into the base box preparation allowing
us to eventually have &ldquo;generic&rdquo; creation scripts + lxc configs built into
vagrant-lxc itself.</p><p>I haven&rsquo;t tried yet but at least in theory you could set up the <code>vagrant</code> user on
an existing container, compress its rootfs and combine it with the <a href=https://github.com/fgrehm/vagrant-lxc/pull/89/files#diff-1>new lxc
template script</a>,
<a href=https://github.com/fgrehm/vagrant-lxc/pull/89/files#diff-2>config file</a> and
<a href=https://github.com/fgrehm/vagrant-lxc/pull/89/files#diff-3>metadata.json</a>
files to build a box. Eventually there will only be the need to have just the
rootfs tarball and the metadata.json files, but for now I&rsquo;d rather to not go
in that direction until I&rsquo;m 100% sure that this approach will work fine.</p><p>Because there is <a href=https://github.com/fgrehm/vagrant-lxc/blob/83377bf8a4b0e5d2aa53dd6c8ce6abd111bc0426/boxes/common/lxc-template>less work</a>
involved on creating new containers than it <a href=https://github.com/fgrehm/vagrant-lxc/blob/5eb15d86676bc0587b7ce80c1e29e69ebebaf9c7/boxes/debian/lxc-template>used to be</a>,
as you can see from the <a href=http://ascii.io/>Asciicast</a> below I was able to cut
down around <code>47%</code> / <code>~9sec</code> of the time taken to bring a vagrant-lxc container
up from scratch.</p><p>I&rsquo;ve already rebuilt all of the current 6 boxes we&rsquo;ve got and I&rsquo;m doing some
testing around them to see if things are working fine before release.</p><p>Ubuntu 13.10 comes with <strong>9</strong> different lxc templates apart from Ubuntu itself
and Debian. I really hope this encourages people to contribute new boxes back
to the project. As with <a href=https://github.com/mitchellh/vagrant/wiki/Available-Vagrant-Boxes>Vagrant itself</a>
I don&rsquo;t have plans to &ldquo;officially&rdquo; support boxes other than Ubuntu ones on the
short term. Feel free to ping me in case you have trouble building them.</p><p><em><strong>UPDATE:</strong> If you want to know more about building your own box have a look
at this <a href=/blog/2013/07/18/crafting-your-own-vagrant-lxc-base-box/>other post</a></em></p><div class=related><h3>Similar articles:</h3><ul><li><a href=/blog/2013/04/28/lxc-provider-for-vagrant/>LXC provider for Vagrant</a></li><li><a href=/blog/2013/05/24/stop-wasting-bandwidth-with-vagrant-cachier/>Stop wasting bandwidth with vagrant-cachier</a></li><li><a href=/blog/2013/01/22/announcing-letter_opener_web-1-0/>Announcing letter_opener_web 1.0</a></li><li><a href=/blog/2013/01/17/100-percent-on-vagrant/>100% on Vagrant</a></li></ul></div></div></div></section><section class=section><div class=container><aside><div id=disqus_thread></div></aside><div id=show_comments><a id=load_comments class="button is-link">Load comments</a></div><script type=text/javascript>var disqus_shortname="fgrehm",hash;function disqus(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}hash=window.location.hash.substr(1),hash.length>8&&hash.substring(0,8)==="comment-"?(disqus(),document.getElementById("show_comments").style.display="none"):document.getElementById("load_comments").onclick=function(){disqus(),document.getElementById("show_comments").style.display="none"}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/fgrehm>Fabio Rehm</a> 2013-2022</p><p>Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/ribice/kiss>Kiss</a>.</p></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z78MGSF72P"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z78MGSF72P",{anonymize_ip:!1})}</script></body></html>