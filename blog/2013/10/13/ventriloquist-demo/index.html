<!doctype html><html xmlns=http://www.w3.org/1999/xhtml><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Ventriloquist demo | fabiorehm.com</title><meta property="og:title" content="Ventriloquist demo - fabiorehm.com"><meta property="og:description" content="From zero to Discourse in a few lines of code"><meta property="og:url" content="https://fabiorehm.com/blog/2013/10/13/ventriloquist-demo/"><meta property="og:site_name" content="fabiorehm.com"><meta property="og:type" content="article"><meta property="og:image" content="https://www.gravatar.com/avatar/2b78c6da27ec7e1419eebc8b683c25a3?s=256"><meta property="article:section" content="Blog"><meta property="article:tag" content="vagrant"><meta property="article:tag" content="ventriloquist"><meta property="article:tag" content="docker"><meta property="article:tag" content="lxc"><meta property="article:tag" content="discourse"><meta property="article:published_time" content="2013-10-13T00:00:00Z"><meta property="article:modified_time" content="2013-10-13T00:00:00Z"><meta name=twitter:card content="summary"><meta name=twitter:site content="@fgrehm"><meta name=twitter:creator content="@fgrehm"><link href=https://fabiorehm.com/index.xml rel=alternate type=application/rss+xml title=fabiorehm.com><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://fabiorehm.com/css/site.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://fabiorehm.com/blog/2013/10/13/ventriloquist-demo/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://fabiorehm.com/><h1 id=nav-heading class="title is-4">fabiorehm.com</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=email href=mailto:site@fabiorehm.com target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></i></span></a><a class=level-item aria-label=github href=https://github.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=twitter href=https://twitter.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="subtitle is-6" href=/tags/vagrant/>#vagrant</a>
| <a class="subtitle is-6" href=/tags/ventriloquist/>#ventriloquist</a>
| <a class="subtitle is-6" href=/tags/docker/>#docker</a>
| <a class="subtitle is-6" href=/tags/lxc/>#lxc</a>
| <a class="subtitle is-6" href=/tags/discourse/>#discourse</a></div><h2 class="subtitle is-6">October 13, 2013</h2><h1 class=title>Ventriloquist demo</h1><div class=content><p>A while ago I stumbled across <a href=https://www.stackmachine.com/blog/web-development-on-a-vm-is-it-slower>this benchmark</a>
by Brandon Liu on <a href=https://www.stackmachine.com>StackMachine</a>&rsquo;s blog comparing
the numbers for performing some typical tasks on his physical machine and doing
the same thing using virtual machines.</p><p>The measurements <a href=https://www.stackmachine.com/blog/web-development-on-a-vm-is-it-slower#test_setup>were made</a>
using <a href=https://github.com/discourse/discourse>Discourse</a> and compared the numbers
of doing things on VirtualBox and VMware Fusion so I <a href=https://twitter.com/fgrehm/status/359445585738211330>got curious</a>
to see how well <a href=https://github.com/fgrehm/vagrant-lxc>vagrant-lxc</a> shared folders
would perform. What I ended up finding is that it seems that Discourse provides a
base box that was configured <a href=https://github.com/discourse/discourse/blob/master/docs/DEVELOPER-ADVANCED.md#building-your-own-vagrant-vm>by hand</a>
and the Chef cookbooks <a href=https://github.com/discourse/discourse/blob/aca567b4d7b9a7a654e12a5de35bee7d9c36e881/Vagrantfile#L37-L48>used</a>
only deal with <a href=https://github.com/discourse/discourse/blob/aca567b4d7b9a7a654e12a5de35bee7d9c36e881/chef/cookbooks/discourse/recipes/default.rb>some basic stuff</a>
and I&rsquo;d have to either do things by hand or write some provisioning scripts on
my own.</p><p>That was actually one of the reasons that made me push <a href=https://github.com/fgrehm/ventriloquist>Ventriloquist</a>
development forward on its &ldquo;last miles&rdquo; before open sourcing it (and it is the
reason why it is used as an example on the project&rsquo;s README BTW ;) While I could
contribute back a set of Chef cookbooks, I decided to set Discourse needs as my
target for deciding when to open source Ventriloquist.</p><p>If you want to see the Ventriloquist in action check out the following Asciicast
or read the step by step right below it.</p><h2 id=try-it-out>Try it out
<a href=#try-it-out><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>First things first, so given you have Vagrant around, do a <code>vagrant plugin install ventriloquist</code>,
<code>git clone https://github.com/discourse/discourse.git</code> and replace the <a href>Chef provisioner</a>
code on the <code>Vagrantfile</code> with the code below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>provision <span style=color:#e6db74>:ventriloquist</span> <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>env<span style=color:#f92672>|</span>
</span></span><span style=display:flex><span>  env<span style=color:#f92672>.</span>services  <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>%w( redis pg:9.1 mailcatcher )</span>
</span></span><span style=display:flex><span>  env<span style=color:#f92672>.</span>platforms <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>%w( nodejs ruby )</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span></span></span></code></pre></div><p>You&rsquo;ll also need to change the base box used to an Ubuntu 13.04 machine, in my
case I&rsquo;ve used <a href=http://bit.ly/vagrant-lxc-raring64-2013-09-28->this</a> vagrant-lxc
box, so the related Vagrant section looks like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span>config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>box <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;raring64&#39;</span>
</span></span><span style=display:flex><span>config<span style=color:#f92672>.</span>vm<span style=color:#f92672>.</span>box_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://bit.ly/vagrant-lxc-raring64-2013-09-28-&#39;</span></span></span></code></pre></div><p>At this point your <code>Vagrantfile</code> should look like <a href=https://gist.github.com/fgrehm/db49cf1207d062f6f8ce>this one</a>
and you should be able to <code>vagrant up</code> the machine to watch Ventriloquist provisioning
take place. It will take a while to finish depending on your internet connection
so grab a coffee while it does its magic.</p><p>Once provisioning has finished, go ahead and <code>vagrant ssh</code> into the VM and run the
following commands to set things up:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /vagrant
</span></span><span style=display:flex><span>./script/setup_dev
</span></span><span style=display:flex><span>rake db:test:prepare
</span></span><span style=display:flex><span>gem install foreman --no-ri --no-rdoc
</span></span><span style=display:flex><span>cp .env.sample .env
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\nPORT=3000&#34;</span> &gt;&gt; .env</span></span></code></pre></div><p>To test that things are set up properly, run the specs with <code>rake spec</code>
and fire up a server with <code>foreman start</code>. If everything went fine, you
should see a green build and verify that Discourse is running by visiting http://localhost:4000
on your browser and signing up. To read the confirmation mail, please visit <a href>MailCatcher</a>&rsquo;s
web interface at http://localhost:4080.</p><h2 id=coming-up>Coming up
<a href=#coming-up><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>Since Ventriloquist can be used to set things up across multiple Vagrant providers,
I&rsquo;ll soon try to get the numbers comparing VirtualBox with <a href=https://github.com/fgrehm/vagrant-lxc>vagrant-lxc</a>
and <a href=https://github.com/smdahlen/vagrant-digitalocean>vagrant-digitalocean</a> to
see how it goes.</p><p><em><strong>UPDATE</strong> (26 AUG 2014): I&rsquo;ve stepped down as a maintainer of the plugin, feel
free to <a href=https://github.com/fgrehm/ventriloquist/issues/63>reach out in case you want to take over responsibility for the project</a></em></p><div class=related><h3>Similar articles:</h3><ul><li><a href=/blog/2013/09/11/announcing-ventriloquist/>Announcing Ventriloquist</a></li><li><a href=/blog/2013/07/18/crafting-your-own-vagrant-lxc-base-box/>Crafting your own vagrant-lxc base box</a></li><li><a href=/blog/2013/06/10/improving-vagrant-lxc-boxes/>Improving vagrant-lxc boxes</a></li><li><a href=/blog/2013/04/28/lxc-provider-for-vagrant/>LXC provider for Vagrant</a></li><li><a href=/blog/2013/08/07/vagrant-lxc-0-5-0-and-beyond/>vagrant-lxc 0.5.0 and beyond</a></li></ul></div></div></div></section><script src=/js/copycode.js></script><section class=section><div class=container><aside><div id=disqus_thread></div></aside><div id=show_comments><a id=load_comments class="button is-link">Load comments</a></div><script type=text/javascript>var disqus_shortname="fgrehm",hash;function disqus(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}hash=window.location.hash.substr(1),hash.length>8&&hash.substring(0,8)==="comment-"?(disqus(),document.getElementById("show_comments").style.display="none"):document.getElementById("load_comments").onclick=function(){disqus(),document.getElementById("show_comments").style.display="none"}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/fgrehm>Fabio Rehm</a> 2013-2022</p><p>Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/ribice/kiss>Kiss</a>.</p></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z78MGSF72P"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z78MGSF72P",{anonymize_ip:!1})}</script></body></html>