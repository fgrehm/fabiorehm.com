<!doctype html><html xmlns=http://www.w3.org/1999/xhtml><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Vundler: Dead easy plugin management for Vagrant | fabiorehm.com</title><meta property="og:title" content="Vundler: Dead easy plugin management for Vagrant - fabiorehm.com"><meta property="og:description" content="Avoid Vagrant plugins Dependency Hell with Vundler"><meta property="og:url" content="https://fabiorehm.com/blog/2013/07/15/vundler-dead-easy-plugin-management-for-vagrant/"><meta property="og:site_name" content="fabiorehm.com"><meta property="og:type" content="article"><meta property="og:image" content="https://www.gravatar.com/avatar/2b78c6da27ec7e1419eebc8b683c25a3?s=256"><meta property="article:section" content="Blog"><meta property="article:tag" content="vagrant"><meta property="article:tag" content="bundler"><meta property="article:tag" content="vundler"><meta property="article:tag" content="vagrant plugins"><meta property="article:published_time" content="2013-07-15T00:00:00Z"><meta property="article:modified_time" content="2013-07-15T00:00:00Z"><meta name=twitter:card content="summary"><meta name=twitter:site content="@fgrehm"><meta name=twitter:creator content="@fgrehm"><link href=https://fabiorehm.com/index.xml rel=alternate type=application/rss+xml title=fabiorehm.com><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://fabiorehm.com/css/site.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://fabiorehm.com/blog/2013/07/15/vundler-dead-easy-plugin-management-for-vagrant/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://fabiorehm.com/><h1 id=nav-heading class="title is-4">fabiorehm.com</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=email href=mailto:site@fabiorehm.com target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></i></span></a><a class=level-item aria-label=github href=https://github.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=twitter href=https://twitter.com/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i></span></a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/fgrehm target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i></span></a><a class=level-item aria-label=rss href=/index.xml target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i></span></a></nav></div></nav><nav class=nav></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><div class="subtitle tags is-6 is-pulled-right"><a class="subtitle is-6" href=/tags/vagrant/>#vagrant</a>
| <a class="subtitle is-6" href=/tags/bundler/>#bundler</a>
| <a class="subtitle is-6" href=/tags/vundler/>#vundler</a>
| <a class="subtitle is-6" href=/tags/vagrant-plugins/>#vagrant plugins</a></div><h2 class="subtitle is-6">July 15, 2013</h2><h1 class=title>Vundler: Dead easy plugin management for Vagrant</h1><div class=content><p><strong>UPDATE</strong> (23 JUL 2013): Vundler has been <a href=/blog/2013/07/23/vundler-is-now-bindler>renamed</a>
to Bindler!</p><p>Vagrant&rsquo;s plugin &ldquo;ecossystem&rdquo; just keep growing and recently there has been a
lot of interest on having an easy way for managing project&rsquo;s specific plugin
dependencies to avoid <a href=http://en.wikipedia.org/wiki/Dependency_hell>Dependency Hell</a>
and / or to reduce the amount of steps someone has to take when joining an
ongoing project. There are at least 4 issues on Vagrant&rsquo;s issue tracker (<a href=https://github.com/mitchellh/vagrant/issues/1874>#1874</a>,
<a href=https://github.com/mitchellh/vagrant/issues/1789>#1789</a>, <a href=https://github.com/mitchellh/vagrant/issues/1700>#1700</a>
and <a href=https://github.com/mitchellh/vagrant/issues/1574>#1574</a>)
and one <a href=https://github.com/tknerr/vagrant-plugin-bundler>initiative</a>
by <a href=https://github.com/tknerr>@tknerr</a> to solve the problem.</p><p>As I said on <a href=https://github.com/mitchellh/vagrant/issues/1874#issuecomment-20137913>this comment</a>
and later clarified on this <a href=https://github.com/mitchellh/vagrant/issues/1874#issuecomment-20146703>other one</a>:</p><blockquote><p>TBH I don&rsquo;t think this belongs on vagrant core itself. An analogy would be
having this logic from inside Ruby on Rails instead of relying on Bundler,
which IMHO does not make sense. Rails just provides the foundation for others
to build plugins and relies on Bundler to get things in place and load plugins&rsquo; code.</p></blockquote><blockquote><p>I really believe we need some sort of Bundler for Vagrant as there are
plugins being created almost every month. I just don&rsquo;t think it belongs on
Vagrant&rsquo;s core.</p></blockquote><p>So I knew that it was something doable but I also knew that it would require some
good knowledge of RubyGems and Vagrant&rsquo;s internals. I&rsquo;ve been brewing the idea on
my head for a while and I had a vague idea of how it could be implemented. Last
week I had some free time and decided to timebox my take on the problem. The result
of 2 hours worth of work is a new plugin called <a href=https://github.com/fgrehm/vundler>Vundler</a>,
a <em>&ldquo;soon-to-be <a href=http://bundler.io/v1.3/rationale.html>Bundler</a> for Vagrant&rdquo;</em>.</p><p>It basically adds a new <code>vagrant plugin bundle</code> command that reads from a project
specific <code>plugins.json</code> <a href=https://github.com/fgrehm/vundler#usage>file</a> and <em><a href=https://github.com/fgrehm/vundler/blob/master/lib/vundler/bend_vagrant.rb>bends</a></em>
Vagrant to do its job with a handful of monkey patches.</p><p>Have a look at the asciicast to see it in action:</p><h2 id=how-does-it-work>How does it work?
<a href=#how-does-it-work><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>First we need to ensure Vundler is the one and only third party plugin that Vagrant
will load automatically and then do our magic. If other plugins are loaded before
Vundler, there is a huge chance that conflicts will happen as you might have
a globally installed version of a plugin that is different from the version a
project needs.</p><p>The simplest thing that could possibly work (and that I can think of right now)
is to trick Vagrant&rsquo;s plugin loading mechanism to only load Vundler and to benefit
from Vagrant&rsquo;s configuration loading order. That is accomplished by making sure
our <code>$HOME/.vagrant.d/plugins.json</code> have only Vundler listed as a plugin and
by having an explicit <code>require "vundler"</code> on our <code>$HOME/.vagrant.d/Vagrantfile</code>.
Because of the way vagrant works, that <code>Vagrantfile</code> will be loaded prior to
any project defined one and we&rsquo;d be good to go.</p><p>This initial setup is handled by <code>vagrant vundler setup</code> that should be invoked right
after the plugin gets installed. The command will move the other plugins defined
on the system wide <code>plugins.json</code> file to <code>$HOME/.vagrant.d/global-plugins.json</code>
and will add the explicit <code>require</code> to the system wide <code>Vagrantfile</code>.</p><p>Once things are properly set up, you should be able to add a <code>plugins.json</code> file
like the one below to your project and just run <code>vagrant plugin bundle</code> to install
the required dependencies:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;vagrant-lxc&#34;</span>,
</span></span><span style=display:flex><span>  {<span style=color:#f92672>&#34;vagrant-cachier&#34;</span>: <span style=color:#e6db74>&#34;0.2.0&#34;</span>}
</span></span><span style=display:flex><span>]</span></span></code></pre></div><p>And that&rsquo;s it! Vundler will even be little bit smart and will only install the plugins
that you haven&rsquo;t installed yet ;)</p><h2 id=declaring-plugins-on-a-json-file-outside-of-a-vagranfile>Declaring plugins on a JSON file outside of a Vagranfile
<a href=#declaring-plugins-on-a-json-file-outside-of-a-vagranfile><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>I wanted to make things transparent to those that don&rsquo;t have an urge to use Vundler
(like myself) and also to avoid having to write a parser for this &ldquo;Vundlerfile&rdquo;. Also
because JSON is bundled with Ruby 1.9.3+ (shipped with Vagrant) and this approach is
more aligned with Vagrant&rsquo;s core that uses a JSON file to keep track of installed plugins.
If by any remote chance this kind of stuff gets into Vagrant&rsquo;s core, this is how I
believe it will look like.</p><p>This is actually one of the reasons why I decided to start from scratch and chose not
to fork @tknerr&rsquo;s awesome <a href=https://github.com/tknerr/vagrant-plugin-bundler>vagrant-plugin-bundler</a>
or follow other users&rsquo; syntax proposed on Vagrant&rsquo;s issue tracker.</p><h2 id=project-specific-gems--plugins-sandbox>Project specific gems / plugins sandbox
<a href=#project-specific-gems--plugins-sandbox><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>With the plugins manifest format defined, I was able to <a href=https://github.com/fgrehm/vundler/blob/master/lib/vundler/plugin_command/bundle.rb>find my way</a>
to install project specific plugins without issues but a problem showed up because
of system wide plugins installation.</p><p>On its current state Vagrant <a href=https://github.com/mitchellh/vagrant/blob/master/plugins/commands/plugin/action/prune_gems.rb>prunes</a>
gems <a href=https://github.com/mitchellh/vagrant/blob/master/plugins/commands/plugin/action.rb#L12-L13>after a plugin</a>
have been installed / uninstalled and that would mean that users would be required
to install dependencies again when switching projects. I&rsquo;m pretty sure Mitchell
have a good reason to do that prunning so I decided to not to change this behavior.</p><p>When you run a <code>vagrant plugin bundle</code>, Vundler will configure RubyGems to install
missing plugins to a local <code>.vagrant/gems</code> folder. When you run other vagrant commands,
Vundler will ensure that the local plugins sandbox takes precedence over the system
wide gems home and you&rsquo;ll be able to use system wide plugins along with project specific
ones.</p><h2 id=whats-with-all-that-monkey-patchinghttpsgithubcomfgrehmvundlerblobmasterlibvundlerbend_vagrantrb>What&rsquo;s with all that <a href=https://github.com/fgrehm/vundler/blob/master/lib/vundler/bend_vagrant.rb>monkey patching</a>?
<a href=#whats-with-all-that-monkey-patchinghttpsgithubcomfgrehmvundlerblobmasterlibvundlerbend_vagrantrb><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>Well, you know&mldr; I timeboxed the development to 2 hours only, that means I had to take
some shortcuts ;) I did my best to document the patches I had to make and I&rsquo;m willing
to look into a way of better accomodating this kind of plugin from within Vagrant&rsquo;s
core.</p><h2 id=its-just-a-start>It&rsquo;s just a start
<a href=#its-just-a-start><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentcolor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 000 6h3a3 3 0 002.83-4H9c-.086.0-.17.01-.25.031A2 2 0 017 10.5H4a2 2 0 110-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 00-2.83 4h1.098A2 2 0 019 6.5h3a2 2 0 110 4h-1.535a4.02 4.02.0 01-.82 1H12a3 3 0 100-6H9z"/></svg></a></h2><p>Vundler is not as powerful as his older brother <a href=http://bundler.io>Bundler</a> and there
are a few things that are currently not supported:</p><ul><li>There is no way to <a href=http://bundler.io/v1.3/man/gemfile.5.html#SOURCES-source->specify a custom RubyGems source</a></li><li>There is no such thing as a <a href=http://stackoverflow.com/a/7518215>lock file</a></li><li>It is not possible to use <a href=http://bundler.io/v1.3/man/gemfile.5.html#GIT-git->plugins from GitHub</a></li><li>It does not attempt to solve conflicts. As an example, if two plugins have different
gem dependency requirements, Vundler won&rsquo;t be able to solve conflicts and things might
start acting weird.</li></ul><p>I&rsquo;m pretty sure we can leverage Bundler itself to have those features in place and I&rsquo;ll
have a look at Bundler&rsquo;s codebase once I have the need for those &ldquo;advanced&rdquo; features.
To be really honest I personally haven&rsquo;t had the need for a tool like Vundler (yet) as
I&rsquo;m currently the only Vagrant user on my project at work and my &ldquo;plugin stack&rdquo; is
basically:</p><ul><li><a href=https://github.com/fgrehm/vagrant-cachier>vagrant-cachier</a></li><li><a href=https://github.com/fgrehm/vagrant-lxc>vagrant-lxc</a></li><li><a href=https://github.com/fgrehm/vagrant-notify>vagrant-notify</a></li><li><a href=https://github.com/fgrehm/vagrant-pristine>vagrant-pristine</a></li><li><a href=https://github.com/dergachev/vagrant-vbox-snapshot>vagrant-vbox-snapshot</a></li></ul><div class=related><h3>Similar articles:</h3><ul><li><a href=/blog/2013/06/10/improving-vagrant-lxc-boxes/>Improving vagrant-lxc boxes</a></li><li><a href=/blog/2013/05/24/stop-wasting-bandwidth-with-vagrant-cachier/>Stop wasting bandwidth with vagrant-cachier</a></li><li><a href=/blog/2013/04/28/lxc-provider-for-vagrant/>LXC provider for Vagrant</a></li><li><a href=/blog/2013/01/22/announcing-letter_opener_web-1-0/>Announcing letter_opener_web 1.0</a></li><li><a href=/blog/2013/01/17/100-percent-on-vagrant/>100% on Vagrant</a></li></ul></div></div></div></section><script src=/js/copycode.js></script><section class=section><div class=container><aside><div id=disqus_thread></div></aside><div id=show_comments><a id=load_comments class="button is-link">Load comments</a></div><script type=text/javascript>var disqus_shortname="fgrehm",hash;function disqus(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}hash=window.location.hash.substr(1),hash.length>8&&hash.substring(0,8)==="comment-"?(disqus(),document.getElementById("show_comments").style.display="none"):document.getElementById("load_comments").onclick=function(){disqus(),document.getElementById("show_comments").style.display="none"}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div></section><section class=section><div class="container has-text-centered"><p>&copy; <a href=https://github.com/fgrehm>Fabio Rehm</a> 2013-2022</p><p>Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/ribice/kiss>Kiss</a>.</p></div></section><script async src="https://www.googletagmanager.com/gtag/js?id=G-Z78MGSF72P"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Z78MGSF72P",{anonymize_ip:!1})}</script></body></html>